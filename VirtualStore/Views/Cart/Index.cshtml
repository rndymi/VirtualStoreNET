@model VirtualStore.Models.Cart

@{
    ViewBag.Title = "Cart";
}

<div class="store-title">
    <h2>Shopping Cart</h2>
</div>

<div class="store-card pad">
    @if (!Model.Items.Any())
    {
        <div class="text-center" style="padding:40px; color:#8a94a6">
            Your cart is empty.
        </div>

        <div class="store-total">Total: <span>€ 0.00</span></div>
    }
    else
    {
        <table class="table table-clean">
            <tr>
                <th></th>
                <th>PRODUCT</th>
                <th>QTY</th>
                <th>UNIT PRICE</th>
                <th class="text-right">SUBTOTAL</th>
                <th></th>
            </tr>

            @foreach (var item in Model.Items)
            {
                <tr>
                    <td style="width:70px;">
                        <img src="@item.ImageURL" style="width:52px; height:52px; object-fit:contain; border-radius:10px; background:#f3f6fb;" />
                    </td>

                    <td><strong>@item.Name</strong></td>

                    <td style="white-space:nowrap;">
                        @using (Html.BeginForm("Decrease", "Cart", FormMethod.Post, new { style = "display:inline;" }))
                        {
                            @Html.AntiForgeryToken()
                            @Html.Hidden("id", item.ProductId)
                            <button type="submit" class="btn btn-outline">-</button>
                        }

                        <span style="margin:0 12px; font-weight:900;">@item.Quantity</span>

                        @using (Html.BeginForm("Increase", "Cart", FormMethod.Post, new { style = "display:inline;" }))
                        {
                            @Html.AntiForgeryToken()
                            @Html.Hidden("id", item.ProductId)
                            <button type="submit" class="btn btn-outline">+</button>
                        }
                    </td>

                    <td>€ @item.UnitPrice</td>

                    <td class="text-right">€ @item.OrderTotal</td>

                    <td class="text-right">
                        @using (Html.BeginForm("Remove", "Cart", FormMethod.Post, new { style = "display:inline;" }))
                        {
                            @Html.AntiForgeryToken()
                            @Html.Hidden("id", item.ProductId)
                            <button type="submit" class="btn btn-danger">X</button>
                        }
                    </td>
                </tr>
            }
        </table>

        <div class="store-total">Total: <span>€ @Model.TotalAmount()</span></div>

        <div class="text-center" style="margin-top:16px;">
            @using (Html.BeginForm("Clear", "Cart", FormMethod.Post, new { style = "display:inline;" }))
            {
                @Html.AntiForgeryToken()
                <button type="submit" class="btn btn-danger">Clear Cart</button>
            }

            @if (User.Identity.IsAuthenticated)
            {
                using (Html.BeginForm("Checkout", "Cart", FormMethod.Post, new { style = "display:inline; margin-left:10px;" }))
                {
                    @Html.AntiForgeryToken()
                    <button type="submit" class="btn btn-success">Checkout</button>
                }
            }
            else
            {
                <a class="btn btn-success" style="margin-left:10px;" href="@Url.Action("Login","Account")">Log in to checkout</a>
            }

            <a class="btn btn-outline" style="margin-left:10px;" href="@Url.Action("Index","Products")">Continue Shopping</a>
        </div>
    }
</div>
