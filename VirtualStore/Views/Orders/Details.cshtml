@model VirtualStore.Order

@{
    ViewBag.Title = "Order Details";
}

@{
    var returnUrl = ViewBag.ReturnUrl as string;
    if (string.IsNullOrWhiteSpace(returnUrl) || !Url.IsLocalUrl(returnUrl))
    {
        returnUrl = Url.Action("Index", "Orders");
    }
}

<div class="store-title">
    <h2>Order Details</h2>
</div>

<div class="store-card pad big-card">
    <div class="row">
        <div class="col-sm-7">
            <p>
                <strong>Order Number:</strong> @Model.Id
            </p>
            <p>
                <strong>Date:</strong> @Model.dateOrder
            </p>
            <p>
                <strong>Status:</strong> @Model.statusOrder
            </p>
        </div>
        <div class="col-sm-5 text-right">
            <div class="order-muted">Total:</div>
            <div class="order-money">€ @Model.totalAmount</div>


            <div>
                @if (User.IsInRole("Admin") || User.IsInRole("Logistics"))
                {
                    @Html.ActionLink(
                        "Edit status",
                        "EditStatus",
                        "Orders",
                        new { id = Model.Id, returnUrl = Request.RawUrl },
                        new { @class = "btn btn-outline" }
                    )
                }
            </div>
        </div>

    </div>

    <h3 style="margin-top:18px;">Products</h3>

    <table class="table table-clean">
        <thead>
            <tr>
                <th style="width:70px;"></th>
                <th>Product</th>
                <th class="text-right">Unit Price</th>
                <th class="text-center" style="width:120px;">Quantity</th>
                <th class="text-right" style="width:140px;">Total</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var detail in Model.OrderDetail)
            {
                <tr>
                    <td>
                        @if (detail.Product != null && !string.IsNullOrWhiteSpace(detail.Product.imageProd))
                        {
                            <img src="@Url.Content(detail.Product.imageProd)"
                                 alt="@detail.Product.nameProd"
                                 style="width:52px;height:52px;object-fit:cover;border-radius:12px;background:#f3f6fb;" />
                        }
                    </td>
                    <td>
                        <strong>@detail.Product.nameProd</strong>
                    </td>
                    <td class="text-right">€ @detail.unitPrice</td>
                    <td class="text-center">@detail.quantity</td>
                    <td class="text-right">€ @detail.orderTotal</td>
                </tr>
            }
        </tbody>
    </table>

    <div class="admin-actions" style="justify-content:space-between; margin-top:16px;">

        @Html.ActionLink(
            "Continue shopping",
            "Index",
            "Products",
            null,
            new { @class = "btn btn-brand" }
        )

        <a href="@returnUrl" class="btn btn-outline">
            Back
        </a>

    </div>
</div>